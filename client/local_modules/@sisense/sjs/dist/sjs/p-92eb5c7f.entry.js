import{r as s,c as e,h as t,g as i}from"./p-c1d35007.js";import{c as n}from"./p-5be7e115.js";const o=class{constructor(t){s(this,t),this.loaded=e(this,"loaded",3),this.persist=!1}connectedCallback(){n.register(this)}disconnectedCallback(){n.unregister(this)}componentWillLoad(){this.loadSisenseJS()}onUrlChange(s,e){s!==e&&this.loadSisenseJS()}loadSisenseJS(){if(!this.url)return;const s=new URL(`${this.url}/js/sisense.v1.js`);this.wat&&s.searchParams.append("wat","true"),function(s){if(document.querySelector(`script[src="${s}"]`))return Promise.resolve();const e=document.createElement("script");return e.src=s,document.head.appendChild(e),new Promise(((s,t)=>{e.onload=s,e.onerror=t}))}(s).then((()=>{console.debug("SisenseJS Downloaded"),this.loadSisense()}))}async logout(){this.appContext.$$dashboard.$identity.signout()}async _getContext(){return this.appContext?this.appContext:new Promise((s=>{this.el.addEventListener("loaded",(()=>{s(this.appContext)}),{once:!0})}))}async getModel(){await this._getContext();const s=window.Sisense.internalScope.prism,{version:e,license:{isTrial:t},user:i}=s;return Object.freeze({version:e,isTrial:t,user:Object.freeze({oid:i._id,email:i.email,username:i.userName,firstName:i.firstName,lastName:i.lastName,role:Object.freeze({oid:i.roleId,name:i.roleName})})})}loadSisense(){console.debug(`Sisense.connect('${this.url}', ${this.persist}, ${JSON.stringify(this.wat)})`),window.Sisense.connect(this.url,this.persist,this.wat).then((s=>{console.debug("Connected to",this.url),this.appContext=s,this.loaded.emit()}))}render(){return t("div",{id:"sisenseApp"},t("slot",null))}get el(){return i(this)}static get watchers(){return{url:["onUrlChange"]}}};export{o as sisense_app}