import{r as t,c as e,h as s,g as i}from"./p-c1d35007.js";import{w as a,d as r}from"./p-6cbd9e3a.js";import{c as d}from"./p-5be7e115.js";const h=class{constructor(s){t(this,s),this.processResult=e(this,"processResult",3),this.ready=e(this,"ready",3),this.beforeQuery=e(this,"beforeQuery",3),this.loaded=e(this,"loaded",3)}async getHighchartsChart(){const t=this.widgetHandle.getElementsByClassName("widget-body")[0];return t?window.Sisense.internalScope.Highcharts.charts[t.dataset.highchartsChart]:null}async _getContext(){return this.widgetContext?this.widgetContext:new Promise((t=>{this.el.addEventListener("loaded",(()=>{t(this.widgetContext)}),{once:!0})}))}async getModel(){const t=await this._getContext();if(!t)return;const{oid:e,title:s,type:i,subtype:a,owner:r,userId:d,instanceType:h,datasource:n,metadata:o,style:c}=t.$$model;return Object.freeze({oid:e,title:s,type:i,subtype:a,owner:r,userId:d,instanceType:h,datasource:n,metadata:o,style:c})}idUpdatedHandler(){this.loadWidget()}widthUpdatedHandler(){this.widgetContext.debouncedRefresh()}heightUpdatedHandler(){this.widgetContext.debouncedRefresh()}connectedCallback(){this.loadWidget()}disconnectedCallback(){this.free()}async loadWidget(){const t=await d.withNearestContext(this,"sisense-dashboard",(t=>{var e;return null!==(e=t.widgets.get(this.oid))&&void 0!==e?e:t.widgets.load(this.oid)}));if(t){for(;!this.widgetHandle;)console.debug("Widget waiting for handle",this.oid),await a(0);t.container=this.widgetHandle,t.on("ready",(()=>{this.ready.emit()})),t.on("processresult",((t,{result:e,reason:s})=>{this.processResult.emit({result:e,reason:s})})),t.on("beforequery",(()=>{this.beforeQuery.emit()})),t.debouncedRefresh=r(t.refresh.bind(t),250),this.widgetContext=t,this.loaded.emit(),console.debug("Loaded Widget",this.oid),d.withNearestContext(this,"sisense-dashboard",(t=>t.refresh()))}}free(){this.widgetContext&&(console.debug("Freeing",this.oid),this.widgetContext.destroy(),this.widgetContext.$$model.destroy(),this.widgetContext=null)}render(){return s("div",{style:{width:this.width?`${this.width}px`:"",height:this.height?`${this.height}px`:""},ref:t=>this.widgetHandle=t})}get el(){return i(this)}static get watchers(){return{oid:["idUpdatedHandler"],width:["widthUpdatedHandler"],height:["heightUpdatedHandler"]}}};export{h as sisense_widget}